<!DOCTYPE html>
<html>

<head>
  <meta charset='UTF-8'/>
  <link href='/app/icon.png' rel='apple-touch-icon' />
  <link href='/ext/mapbox.css' rel='stylesheet' />
  <link href='/ext/base/base.css' rel='stylesheet' />
  <link href='/app/app.css' rel='stylesheet' />
  <script src='/ext/underscore-min.js'></script>
  <script src='/ext/jquery-2.0.3.min.js'></script>
  <script src='/ext/jquery.sortable.js'></script>
  <script src='/ext/backbone.js'></script>
  <script src='/ext/mapbox.js'></script>
  <script src='/app/cartoref.js'></script>
  <script src='/app/lib.js?_=<%= +new Date %>'></script>
  <script src='/app/style.js?_=<%= +new Date %>'></script>
  <script src='/app/print.js?_=<%= +new Date %>'></script>
  <script src='/ext/sexagesimal.js'></script>
  <link href='/app/print.css' rel='stylesheet' />
  <link href='/ext/leaflet-locationfilter/locationfilter.css' rel='stylesheet' />
  <script src='/ext/leaflet-locationfilter/locationfilter.js'></script>
  <script src='/ext/sphericalmercator.js'></script>


  <title><%= style.name %></title>
</head>

<body id='view' class='<%= agent %> clip'><div id='app' class='pin-top pin-bottom animate'>

<a id='home'></a>
<a id='baselayer'></a>

<div id='modal'>
  <div class='modal-mask fill-darken2 animate'></div>
  <div id='modal-content' class='limiter contain modal-content animate'></div>
</div>

<div id='user' class='z10 col12 pin-top'>
  <a href='#' class='fill-darken1 col12 pin-left pin-bottom'></a>
  <div class='megamenu caret1 fill-light col5 pin-topleft'>
    <%= this.history(obj) %>
    <div class='demo-popup col8 pin-bottomright offcanvas-right pad2 bottom2 fill-blue dark'>
      <h3>Switching projects</h3>
      <small class='space-bottom4'>
      Click your avatar to see styles you've edited recently or start a new style. Switch to the <strong>Sources</strong> pane to create or edit vector sources from your custom data.
      </small>
      <div class='pin-bottom clearfix center'><!--
      --><a href='#settings' class='small fill-darken0 pad1 col6 icon prev quiet keyline-right'>Prev</a><!--
      --><a href='#start' class='small fill-darken0 pad1 col6 icon check quiet'>Done</a>
      </div>
    </div>
  </div>
</div>

<form id='settings' class='z10 col12 pin-top'>
  <a href='#' class='fill-darken1 col12 pin-left pin-bottom'></a>
  <div class='megamenu caret2 fill-light col5 pin-topleft'>
  <a class="pad1 quiet icon x pin-topright" href="#"></a>
    <header class='pad1 keyline-bottom'>
      <h3>Settings</h3>
    </header>
    <div class='pin-left col12 scroll-styled pad2 top1 bottom2'>
      <fieldset>
        <section class='space-bottom1'>
          <label>Name</label>
          <input class='short small stretch' name='name' type='text' value='<%= _(style.name).escape() %>'/>
        </section>
        <section class='space-bottom1'>
          <label>Description</label>
          <textarea class='short small stretch' name='description' type='text' cols='60' rows='8'><%= style.description %></textarea>
        </section>
        <section>
          <label>Attribution</label>
          <input class='short small stretch' name='attribution' type='text' value='<%= _(style.attribution).escape() %>'></input>
        </section>
      </fieldset>
      <fieldset class='pad1 space-bottom2 keyline-all round'>
        <section class='space-bottom1 clearfix'>
          <label class='inline col4'>Image format</label>
          <select name='format'>
            <% _({
              'png24': 'png (24-bit)',
              'png8:m=h': 'png (256 colors)',
              'png8:m=h:c=192': 'png (192 colors)',
              'png8:m=h:c=128': 'png (128 colors)',
              'png8:m=h:c=64': 'png (64 colors)',
              'png8:m=h:c=32': 'png (32 colors)',
              'jpeg95': 'jpeg (95%)',
              'jpeg90': 'jpeg (90%)',
              'jpeg85': 'jpeg (85%)',
              'jpeg80': 'jpeg (80%)'
            }).each(function(label, format) { %>
            <option value='<%= format %>' <% if (style.format === format) { %> selected='selected' <% } %>><%= label %></option>
            <% }); %>
          </select>
        </section>
        <section class='space-bottom0 clearfix'>
          <label class='inline col4'>Minzoom</label>
          <input id='minzoom' name='minzoom' class='min' type='range' value='<%= style.minzoom %>' min='0' max='22' step='1' onchange='rangeHandler(this, "max", "#maxzoom");' />
          <span class='small quiet code inline range' id='minzoom-val'><%= style.minzoom %></span>
        </section>
        <section class='space-bottom0 clearfix'>
          <label class='inline col4'>Maxzoom</label>
          <input id='maxzoom' name='maxzoom' class='max' type='range' value='<%= style.maxzoom %>' min='0' max='22' step='1' onchange='rangeHandler(this, "min", "#minzoom");' />
          <span class='small quiet code inline range' id='maxzoom-val'><%= style.maxzoom %></span>
        </section>
        <section class='space-bottom0 clearfix'>
          <label class='inline col4'>Resolution <br> <em class='small quiet'> screen resolution recommended </em></label>
          <div class='rounded-toggle inline resolution'>
            <input id='screenresolution' name='rtoggle' type='radio' value='screenresolution' <% if (!style._prefs.print) {%> checked <%}%>/>
            <label for='screenresolution'>Screen</label>
            <input id='printresolution' name='rtoggle' type='radio' value='printresolution' <% if (style._prefs.print) {%> checked <%}%>/>
            <label for='printresolution'>Print</label>
          </div>
        </section>
        <% if (style._prefs.mapid) { %>
        <section class='space-bottom0 clearfix'>
          <label class='inline col4 pad0y' for='map_id'>Map ID</label>
          <input id='map_id' class='code clean short small col8 readonly' name='mapid' type='text' value='<%= _(style._prefs.mapid).escape() %>' placeholder='Mapbox map id' readonly disabled></input>
        </section>
        <% } %>
      </fieldset>
      <fieldset class='fill-darken0 pad1 round'>
        <div class='space-bottom0 small quiet'><em>Underlay your style with a Mapbox map. For reference only.</em></div>
        <section class='clearfix'>
          <label class='inline col4 pad0y' for='baselayer_id'>Baselayer ID</label>
          <input id='baselayer_id' class='code short small col8' name='baselayer' type='text' value='<%= _(style._prefs.baselayer).escape() %>' placeholder='Mapbox map id'></input>
        </section>
      </fieldset>
    </div>
    <div class='settings-footer pad2y fill-light keyline-top round-bottom pin-bottom'>
      <section class='pad1x col12 clearfix'>
        <% if (style._tmp) { %>
        <div class='pad1x col12'>
          <a class='button col12 quiet icon floppy js-saveas'>Save as</a>
        </div>
        <% } else { %>
        <div class='pad1x col4'>
          <a class='button col12 quiet icon js-save floppy'>Save</a>
        </div>
        <div class='pad1x pill col8'><!--
        --><a href='/style.tm2z?id=<%=style.id%>' class='button quiet col4 <% if (!user.plan.tm2z) { %>col12<% } %> submit icon package'>Package</a><!--
        --><a href='#settings' class='js-upload button quiet col4 submit icon up'>Upload</a><!--
        --><a href='#settings' id='print-style' class='button quiet col4 submit printer icon'>Print</a><!--
     --></div>
        <% } %>
      </section>
    </div>
    <div class='demo-popup col8 pin-topright offcanvas-right pad2 top2 fill-blue dark'>
      <h3>Publishing</h3>
      <small class='space-bottom4'>
      Styles can be packaged as <code>.tm2z</code> files that include your style and any image resources in your style folder. Click the <strong class='icon package'>Package</strong> button or <strong class='icon up'>Upload</strong> directly to your Mapbox account.
      </small>
      <div class='pin-bottom clearfix center'><!--
      --><a href='#layers' class='small fill-darken0 pad1 col6 icon prev quiet keyline-right'>Prev</a><!--
      --><a href='#user' class='small fill-darken0 pad1 col6 rcon next quiet'>Next</a>
      </div>
    </div>
  </div>
</form>

<form id='bookmark' class='tip-bottom z10 contain fill-white round animate'>
  <input id='addbookmark' type='text' class='col12 clean round small' value='' placeholder='Name a bookmark' autocomplete='off' />
  <div class='pin-topright pad0'>
    <input type='submit' class='short quiet button' value='Add' />
  </div>
  <ul id='bookmark-list' class='clip fill-light scroll-styled round-bottom'></ul>
</form>

<form id='search' class='tip-bottom z10 contain fill-white round animate'>
  <input id='dosearch' type='text' class='col12 clean small round' value='' placeholder='Search' autocomplete='off' />
  <div class='pin-topleft pad1'>
    <span class='icon search'></span>
  </div>
  <ul id='search-results' class='clip fill-light scroll-styled round-bottom'></ul>
</form>

<div id='full' class='z1 clip animate pin-left'>
  <div id='title' class='contain inline pin-topleft z1'>
    <span class='inline clip fill-darken3 dark row1 round-bottomright'><!--
      --><a href='#user' class='inline avatar align-middle'><img src='<%= user.avatar %>' /></a><!--
      --><strong class='unround icon paint project-name small js-name inline pad1 truncate'><%= style.name || 'Untitled' %></strong><!--
      --><span class='pad0x row1 inline'><!--
      --><a href='#settings' class='round-left icon sprocket short button inline keyline-right'>Settings</a><!--
      <% if (style._tmp) { %>
        --><a class='js-saveas round-right short button icon inline floppy'>Save as</a>
      <% } else { %>
        --><a class='round-right js-save short button icon inline floppy' href='#'>Save</a>
      <% } %>
    </span>
  </div>
  <div id='map' class='animate' style='background-color:<%=style.background%>;'></div>
  <div id='map-overlay' class='overlay'></div>
  <div id='map-errors'></div>
  <div id='zoomedto' class='z<%=style.center[2]%>'></div>
  <div id='map-controls'>
    <div class='inline'>
      <div class='z1 fill-white'>
        <a href='#' id='zoom-in' title='Zoom in' class='icon plus keyline-right quiet'></a><!--
        --><a href='#' id='zoom-out' title='Zoom out' class='icon minus keyline-right quiet'></a>
      </div>
    </div>
    <div class='inline'>
      <div class='z1 fill-white'>
        <a href='#search' title='Search' class='search-n keyline-right icon search quiet '></a><!--
        --><a href='#' title='Close search' class='search-y icon keyline-right search fill-dark dark'></a><!--
        --><a href='#bookmark' title='Bookmarks' class='bookmark-n icon marker quiet'></a><!--
        --><a href='#' title='Close bookmarks' class='bookmark-y icon marker fill-dark dark'></a>
      </div>
    </div>
    <span class='base-toggle'>
      <a href='#baselayer' title='Toggle baselayer' id='baselayer' class='baselayer-n inline icon mt fill-white quiet' <% if (!style._prefs.baselayer) { %>style='display:none;'<% }%>></a>
      <a href='#home' title='Toggle baselayer' id='baselayer' class='baselayer-y inline icon mt dark fill-dark' <% if (!style._prefs.baselayer) { %>style='display:none;'<% }%>></a>
    </span>
    <a href='#full' title='Toggle fullscreen' class='full-n inline fill-white icon fullscreen quiet'></a>
    <a href='#' title='Exit fillscreen' class='full-y fill-dark dark icon fullscreen'></a>
  </div>
  <div class='demo-popup col6 pin-bottomleft pad2 bottom2 fill-blue dark'>
    <h3>Inspecting data</h3>
    <small class='space-bottom4'>
    TM2 styles are powered by vector tiles that contain feature data and attributes. Use the <strong class='icon eye'>inspector</strong> to see a wireframe of the raw vector data. Click the map to view details about a feature.
    </small>
    <div class='pin-bottom clearfix center'><!--
    --><a href='#home' class='small fill-darken0 pad1 col6 icon prev quiet keyline-right'>Prev</a><!--
    --><a href='#docs' class='small fill-darken0 pad1 col6 rcon next quiet'>Next</a>
    </div>
  </div>
</div>


<div id='layers' class='pin-right col6 z1'>
  <div class='col6 pin-left scroll-styled menu dark fill-dark animate pane'>
    <nav class='pad0y pad1x row1 keyline-bottom fill-darken1'>
      <a href='#layers' class='js-modalsources button short icon point-line'>Change source</a>
      <a class='pad1 quiet icon x pin-topright' href='#'></a>
    </nav>
    <div class='js-menu-content'>
      <%= _(sources).map(this.sourcelayers).join('\n') %>
    </div>
  </div>
  <div class='demo-popup col6 pin-bottomleft pad2 bottom2 fill-blue dark'>
    <h3>Vector sources</h3>
    <small class='space-bottom4'>
    Each style is powered by a vector source. Click a layer to see more about the data that can be styled. Use the <strong class='icon point-line'>Change source</strong> button to switch out the active vector source for another.
    </small>
    <div class='pin-bottom clearfix center'><!--
    --><a href='#fonts' class='small fill-darken0 pad1 col6 icon prev quiet keyline-right'>Prev</a><!--
    --><a href='#settings' class='small fill-darken0 pad1 col6 rcon next quiet'>Next</a>
    </div>
  </div>
</div>

<div id='print-ui' class='animate z1 col6 pin-right fill-light'>
  <div id='print' class='z1 pin-left col12'>
    <div class='pin-topleft z1 row1 keyline-bottom'><!--
      --><a title='Documentation' class='pad1 inline docs-n icon help unround align-middle fill-darken0 keyline-right' href='#docs'></a><!--
      --><a title='Documentation' class='pad1 inline docs-y icon help unround align-middle fill-darken2 keyline-right' href='#'></a><!--
      -->
      <a title='Fullscreen' class='pad1 inline quiet docs-n icon l-r-arrow unround align-middle fill-darken0 keyline-right' href='#full'></a><!--
      -->
      <strong class='small inline pad1y pad4x'>Export Settings</strong>
    </div>
    <br>
    <br>
    <div>
      <div class='keyline-bottom pad1'>
        <fieldset>
          <label class='pad1x inline'>Filename</label>
          <input class='exportInput' type='text' value='<%=style.name %>' />.<span class='format'>png</span>
        </fieldset>
      </div>
      <div class='keyline-bottom pad1 round'>
        <label class='label pad1x inline'>Format </label>
        <div id='formatInput' class='rounded-toggle inline short'>
          <input id='png' type='radio' name='rtoggle' value='png' checked='checked'>
          <label for='png'>png</label>
          <input id='jpeg' type='radio' name='rtoggle' value='jpeg'>
          <label for='jpeg'>jpeg</label>
        </div>
        <fieldset class='pad1'>
          <label >Scale</label>
          <input id='scale' type='range' value='1' min='1' max='4' step='1'>
          <br>
          <span id='scaleValue'>1</span>x for <span id='dpi'>72</span> dpi
        </fieldset>
      </div>
    <div class='keyline-bottom pad1'>
      <a href="#" id='bboxEnable'>click for bounding box</a>
    </div>

    <div class='keyline-bottom pad1 round'>
      <fieldset>
        <label class='inline'>Bounds</label>
        <input id='bboxInput' class='exportInput' type='text' value='' />
        <br>
        <label class='inline'>Center</label>
        <input id='centerInput' class='exportInput' type='text' value='' />
        <br>
        <input id='redraw' class='quiet' type='submit' value='Redraw' name='' />
      </fieldset>
    </div>
    <div class='keyline-bottom pad1 round'>
      Dimensions: <span id='dimX'>wut</span> x <span id='dimY'>lol</span> (<span id='imageSize'></span>)
      <br>
      <span class='warning'>Image is at <span id='sizePerc'>lol</span>% of size limit</span>
    </div>
    <div class='keyline-bottom pad1 round'>
      <input id='export' type='button' class='button disabled' value='Export Static Map' name='' />
    </div>
    </div>
  </div>
</div>

</div>

<script>
var cwd = <%= JSON.stringify(cwd) %>;
var style = <%= JSON.stringify(style) %>;
var templates = {};
templates.modalbrowser = <%= this.modalbrowser.source %>;
templates.modalbrowsersave = <%= this.modalbrowsersave.source %>;
templates.modalbrowseropen = <%= this.modalbrowseropen.source %>;
templates.modaladdtab = <%= this.modaladdtab.source %>;
templates.modalmessage = <%= this.modalmessage.source %>;
templates.modalsources = <%= this.modalsources.source %>;
templates.modalerror = <%= this.modalerror.source %>;
templates.sourceitem = <%= this.sourceitem.source %>;
templates.sourcelayers = <%= this.sourcelayers.source %>;
Print(templates, cwd, style);
console.log(style)
</script>

<% if (test) { %>
  <link href='/app/test/mocha.css' rel='stylesheet' />
  <style>body{padding:0;line-height:1;}/*Bad Mocha*/</style>
  <script src='/app/test/chai.js'></script>
  <script src='/app/test/mocha.js'></script>
  <div id='mocha' class='modal target round pad2 col6 scroll-styled row8 margin3 fill-light'></div>
  <a href='#' id='mask' class='fill-darken2 animate'></a>
  <script src='/app/test/app.test.js'></script>
<% } %>

</body>
</html>
